<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>ArtMera - Generator Mărțișor</title>
    <style>
        body { font-family: sans-serif; background: #efebe9; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .controls { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 400px; margin-bottom: 20px; }
        canvas { border: 5px solid #5d4037; border-radius: 15px; max-width: 100%; height: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .btn { background: #d32f2f; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; width: 100%; }
        select, input, textarea { width: 100%; margin: 10px 0; padding: 8px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="controls">
    <h3>Personalizează Mărțișorul</h3>
    <input type="file" id="upload" accept="image/*">
    <select id="langSelect">
        <option value="ro">Română</option>
        <option value="en">English</option>
        <option value="es">Español</option>
    </select>
    <textarea id="messageText">O primăvară plină de bucurii!</textarea>
    <button class="btn" onclick="draw()">Generează Mărțișor</button>
    <button class="btn" style="background: #4caf50;" onclick="download()">Descarcă Imaginea</button>
</div>

<canvas id="martisorCanvas" width="800" height="800"></canvas>

<script>
const canvas = document.getElementById('martisorCanvas');
const ctx = canvas.getContext('2d');

// Încărcăm resursele (Înlocuiește URL-urile cu fișierele tale locale)
const bgWood = new Image();
bgWood.src = 'fundal_tei_gravat.jpg'; // Imaginea cu textura și hornarii gravate

function draw() {
    const reader = new FileReader();
    const file = document.getElementById('upload').files[0];

    if (!file) {
        alert("Te rugăm să încarci o poză mai întâi!");
        return;
    }

    reader.onload = function(event) {
        const userImg = new Image();
        userImg.onload = function() {
            // 1. Desenăm fundalul de lemn gravat
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(bgWood, 0, 0, 800, 800);

            // 2. Desenăm cercul pentru poză
            const centerX = 400;
            const centerY = 350;
            const radius = 180;

            ctx.save();
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.closePath();
            ctx.clip(); // Tăiem tot ce iese din cerc

            // Calculăm aspect ratio pentru poza utilizatorului
            const aspect = userImg.width / userImg.height;
            let drawW, drawH;
            if (aspect > 1) {
                drawH = radius * 2;
                drawW = drawH * aspect;
            } else {
                drawW = radius * 2;
                drawH = drawW / aspect;
            }
            
            ctx.drawImage(userImg, centerX - drawW/2, centerY - drawH/2, drawW, drawH);
            ctx.restore();

            // 3. Desenăm bordura Mărțișor (firul alb-roșu)
            ctx.lineWidth = 15;
            ctx.setLineDash([20, 20]); // Efect de fir împletit
            ctx.strokeStyle = "#d32f2f"; // Roșu
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius + 7, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.strokeStyle = "#ffffff"; // Alb
            ctx.lineDashOffset = 20;
            ctx.stroke();
            ctx.setLineDash([]); // Resetăm dash-ul

            // 4. Adăugăm Mesajul de primăvară (jos)
            ctx.fillStyle = "#4e342e";
            ctx.font = "italic bold 35px 'Georgia'";
            ctx.textAlign = "center";
            const text = document.getElementById('messageText').value;
            ctx.fillText(text, 400, 720);
        };
        userImg.src = event.target.result;
    };
    reader.readAsDataURL(file);
}

function download() {
    const link = document.createElement('a');
    link.download = 'martisor-artmera.png';
    link.href = canvas.toDataURL();
    link.click();
}
</script>

</body>
</html>
